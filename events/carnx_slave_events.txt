namespace = carnx_slave

# Buy slaves from slave traders
carnx_slave.0001 = {
	type = character_event
	title = carnx_slave.0001.t
	desc = carnx_slave.0001.desc

	theme = stewardship
	left_portrait = scope:valuable_option
	right_portrait = scope:common_option

	trigger = { exists = capital_province }

	immediate = {
		hidden_effect = {
			random_independent_ruler = {
				limit = {
					NOR = {
						faith = root.faith
						culture = root.culture
					}
				}
				save_scope_as = foreign_ruler
			}

			# Valuable option
			create_character = {
				location = root.capital_province
				template_character = scope:foreign_ruler
				gender_female_chance = 100
				age = { 16 40 }
				dynasty = none
				random_traits = yes
				random_traits_list = {
					count = 1
					beauty_good_1 = {}
					beauty_good_2 = {}
					beauty_good_3 = {}
					intellect_good_1 = {}
					intellect_good_2 = {}
					intellect_good_3 = {}
					physique_good_1 = {}
					physique_good_2 = {}
					physique_good_3 = {}
					fecund = {}
					physician_2 = {}
					physician_3 = {}
					mystic_2 = {}
					mystic_3 = {}
					lifestyle_herbalist = {}
				}
				martial = {
					min_template_low_skill
					max_template_decent_skill
				}
				stewardship = {
					min_template_low_skill
					max_template_decent_skill
				}
				diplomacy = {
					min_template_low_skill
					max_template_decent_skill
				}
				intrigue = {
					min_template_low_skill
					max_template_decent_skill
				}
				learning = {
					min_template_low_skill
					max_template_decent_skill
				}
				save_scope_as = valuable_option
			}

			if = {
				limit = { exists = scope:valuable_option }
				scope:valuable_option = {
					save_scope_value_as = {
						name = valuable_option_price
						value = { value = carnx_slave_base_price_value multiply = 1.2 }
					}
					save_scope_as = slave
				}
				save_scope_value_as = {
					name = valuable_option_ai_accept_value
					value = { value = carnx_sell_slave_ai_accept_value_no_actor add = 25 min = 0 }
				}
			}

			# Common option
			create_character = {
				location = root.capital_province
				template_character = scope:foreign_ruler
				gender_female_chance = 100
				age = { 16 40 }
				dynasty = none
				random_traits = yes
				save_scope_as = common_option
			}

			if = {
				limit = { exists = scope:common_option }
				scope:common_option = {
					save_scope_value_as = {
						name = common_option_price
						value = { value = carnx_slave_base_price_value multiply = 1.2 }
					}
					save_scope_as = slave
				}
				save_scope_value_as = {
					name = common_option_ai_accept_value
					value = { value = carnx_sell_slave_ai_accept_value_no_actor add = 25 min = 0 }
				}
			}
		}
	}

	# Valuable option
	option = {
		name = carnx_slave.0001.a

		trigger = {
			exists = scope:valuable_option
			short_term_gold >= scope:valuable_option_price
			is_landed = yes #extra check to make sure they haven't lost their status
		}
		show_as_unavailable = { always = yes }

		remove_short_term_gold = scope:valuable_option_price

		hidden_effect = {
			scope:common_option = { silent_disappearance_effect = yes }
			debug_log = "Buy Slaves valuable option chosen"
		}

		carn_enslave_effect = {
			SLAVE = scope:valuable_option
			OWNER = root
			DRAMA = no
		}

		ai_chance = {
			base = 0
			modifier = {
				always = yes
				add = scope:valuable_option_ai_accept_value
			}
			modifier = {
				short_term_gold < medium_gold_value
				factor = 0
			}
		}
	}

	# Common option
	option = {
		name = carnx_slave.0001.b

		trigger = {
			exists = scope:common_option
			short_term_gold >= scope:common_option_price
			is_landed = yes #extra check to make sure they haven't lost their status
		}
		show_as_unavailable = { always = yes }

		remove_short_term_gold = scope:common_option_price

		hidden_effect = {
			scope:valuable_option = { silent_disappearance_effect = yes }
			debug_log = "Buy Slaves common option chosen"
		}

		carn_enslave_effect = {
			SLAVE = scope:common_option
			OWNER = root
			DRAMA = no
		}

		ai_chance = {
			base = 0
			modifier = {
				always = yes
				add = scope:common_option_ai_accept_value
			}
			modifier = {
				short_term_gold < medium_gold_value
				factor = 0
			}
		}
	}

	# None...
	option = {
		name = carnx_slave.0001.c

		hidden_effect = {
			scope:valuable_option = { silent_disappearance_effect = yes }
			scope:common_option = { silent_disappearance_effect = yes }
		}

		ai_chance = {
			factor = 1
		}
	}
}
